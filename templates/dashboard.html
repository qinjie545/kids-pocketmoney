<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›¶é’±ç®¡ç†ç³»ç»Ÿ - ä¸»æ§å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 24px;
        }

        .header .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header .username {
            font-weight: 500;
        }

        .header .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .header .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .stat-card .label {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
        }

        .stat-card.balance .value {
            color: #667eea;
        }

        .stat-card.income .value {
            color: #10b981;
        }

        .stat-card.expense .value {
            color: #ef4444;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .card .card-title {
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .transaction-form {
            display: grid;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #333;
            font-size: 14px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .type-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .type-btn.active {
            border-color: #667eea;
            color: #667eea;
        }

        .type-btn.income.active {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .type-btn.expense.active {
            background: #ef4444;
            border-color: #ef4444;
            color: white;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .transactions-list {
            min-height: 200px;
            max-height: 600px;
            overflow-y: auto;
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            flex-wrap: wrap;
            gap: 10px;
        }

        .pagination-info {
            color: #666;
            font-size: 13px;
            font-weight: 500;
        }

        .pagination-controls {
            display: flex;
            gap: 6px;
            align-items: center;
            flex-wrap: wrap;
        }

        .pagination-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            color: #333;
            font-weight: 500;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-1px);
        }

        .pagination-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #f5f5f5;
        }

        .pagination-page {
            padding: 6px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            font-size: 13px;
            min-width: 36px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .pagination-page:hover:not(.active) {
            background: #f0f0f0;
            border-color: #ccc;
        }

        .pagination-page.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .pagination {
                flex-direction: column;
                align-items: stretch;
            }

            .pagination-info {
                text-align: center;
                margin-bottom: 10px;
            }

            .pagination-controls {
                justify-content: center;
            }
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-category {
            font-weight: 500;
            color: #333;
            margin-bottom: 3px;
        }

        .transaction-description {
            font-size: 12px;
            color: #999;
        }

        .transaction-amount {
            font-weight: 600;
            font-size: 16px;
        }

        .transaction-amount.income {
            color: #10b981;
        }

        .transaction-amount.expense {
            color: #ef4444;
        }

        .transaction-date {
            font-size: 12px;
            color: #999;
            margin-left: 10px;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            transition: background 0.2s;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        .chart-container {
            grid-column: 1 / -1;
            height: 350px;
        }

        .simple-chart {
            width: 100%;
            height: 280px;
            position: relative;
            margin-top: 20px;
        }

        .chart-svg {
            width: 100%;
            height: 100%;
        }

        .chart-line {
            fill: none;
            stroke: #667eea;
            stroke-width: 2;
        }

        .chart-area {
            fill: rgba(102, 126, 234, 0.1);
            stroke: none;
        }

        .chart-grid {
            stroke: #eee;
            stroke-width: 1;
        }

        .chart-label {
            font-size: 12px;
            fill: #666;
        }

        .chart-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            display: none;
            z-index: 100;
        }

        .chart-bar {
            transition: opacity 0.2s;
        }

        .chart-bar:hover {
            opacity: 0.8;
        }

        .chart-bar.balance {
            fill: #667eea;
        }

        .chart-bar.income {
            fill: #10b981;
        }

        .chart-bar.expense {
            fill: #ef4444;
        }

        .config-btn.active {
            background: #667eea;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .message {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .message.success {
            background: #efe;
            color: #3c3;
        }

        .message.error {
            background: #fee;
            color: #c33;
        }

        .config-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .config-btn:hover {
            background: #5568d3;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 0;
            max-width: 1000px;
            width: 90%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            border-bottom: 1px solid #eee;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-header h2 {
            margin: 0;
            color: white;
            font-size: 20px;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .schedule-form-panel {
            flex: 0 0 420px;
            padding: 25px;
            border-right: 1px solid #eee;
            overflow-y: auto;
            background: #fafbfc;
        }

        .schedule-form-panel::-webkit-scrollbar,
        .schedule-list-panel::-webkit-scrollbar,
        .schedule-list::-webkit-scrollbar {
            width: 6px;
        }

        .schedule-form-panel::-webkit-scrollbar-track,
        .schedule-list-panel::-webkit-scrollbar-track,
        .schedule-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .schedule-form-panel::-webkit-scrollbar-thumb,
        .schedule-list-panel::-webkit-scrollbar-thumb,
        .schedule-list::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        .schedule-form-panel::-webkit-scrollbar-thumb:hover,
        .schedule-list-panel::-webkit-scrollbar-thumb:hover,
        .schedule-list::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        .schedule-list-panel {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .schedule-list-panel h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }

        .schedule-list {
            flex: 1;
            overflow-y: auto;
        }

        .schedule-item {
            background: white;
            border-radius: 8px;
            padding: 18px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .schedule-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .schedule-info {
            flex: 1;
        }

        .schedule-info h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 15px;
            font-weight: 600;
        }

        .schedule-info p {
            margin: 0;
            color: #666;
            font-size: 13px;
            line-height: 1.5;
        }

        .schedule-amount {
            color: #10b981;
            font-weight: 600;
            font-size: 16px;
            margin-right: 10px;
        }

        .schedule-actions {
            display: flex;
            gap: 8px;
        }

        .schedule-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .edit-btn {
            background: #667eea;
            color: white;
        }

        .edit-btn:hover {
            background: #5568d3;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        .add-schedule-form {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .add-schedule-form h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 16px;
            font-weight: 600;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .add-schedule-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: transform 0.2s;
            margin-top: 5px;
        }

        .add-schedule-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
        }

        .add-schedule-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .empty-schedules {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            font-size: 14px;
        }

        .empty-schedules-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        @media (max-width: 900px) {
            .modal-body {
                flex-direction: column;
            }

            .schedule-form-panel {
                flex: 0 0 auto;
                border-right: none;
                border-bottom: 1px solid #eee;
                max-height: 50vh;
            }

            .schedule-list-panel {
                flex: 1;
                max-height: 50vh;
            }
        }

        .config-btn.active {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ’° é›¶é’±ç®¡ç†ç³»ç»Ÿ</h1>
        <div class="user-info">
            <span class="username">{{ username }}</span>
            <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
        </div>
    </div>

    <div class="container">
        <div class="stats-grid">
            <div class="stat-card balance">
                <div class="label">å½“å‰ä½™é¢</div>
                <div class="value" id="balance">Â¥0.00</div>
            </div>
            <div class="stat-card income">
                <div class="label">æ€»æ”¶å…¥</div>
                <div class="value" id="income">Â¥0.00</div>
            </div>
            <div class="stat-card expense">
                <div class="label">æ€»æ”¯å‡º</div>
                <div class="value" id="expense">Â¥0.00</div>
            </div>
        </div>

        <div class="main-content">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div class="card-title" style="margin: 0;">è®°ä¸€ç¬”</div>
                    <button class="config-btn" onclick="openScheduleModal()">âš™ å®šæ—¶å‘æ”¾é…ç½®</button>
                </div>
                <div class="transaction-form">
                    <div class="type-selector">
                        <button class="type-btn income active" onclick="setType('income')">æ”¶å…¥</button>
                        <button class="type-btn expense" onclick="setType('expense')">æ”¯å‡º</button>
                    </div>

                    <div class="form-group">
                        <label>é‡‘é¢</label>
                        <input type="number" id="amount" placeholder="è¯·è¾“å…¥é‡‘é¢" step="0.01" min="0.01">
                    </div>

                    <div class="form-group">
                        <label id="categoryLabel">åˆ†ç±»</label>
                        <select id="category">
                            <optgroup label="æ”¶å…¥æ¥æº" id="incomeCategories">
                                <option value="é›¶èŠ±é’±">é›¶èŠ±é’±</option>
                                <option value="å¥–åŠ±">å¥–åŠ±</option>
                                <option value="çº¢åŒ…">çº¢åŒ…</option>
                                <option value="ç¤¼ç‰©">ç¤¼ç‰©</option>
                                <option value="å¸®å¿™å®¶åŠ¡">å¸®å¿™å®¶åŠ¡</option>
                                <option value="å‹å²é’±">å‹å²é’±</option>
                            </optgroup>
                            <optgroup label="æ”¯å‡ºç”¨é€”" id="expenseCategories">
                                <option value="é›¶é£Ÿ">é›¶é£Ÿ</option>
                                <option value="æ–‡å…·">æ–‡å…·</option>
                                <option value="ç©å…·">ç©å…·</option>
                                <option value="æ¸¸æˆ">æ¸¸æˆ</option>
                                <option value="ä¹¦ç±">ä¹¦ç±</option>
                                <option value="å¨±ä¹">å¨±ä¹</option>
                                <option value="äº¤é€š">äº¤é€š</option>
                                <option value="ç¤¼ç‰©">ç¤¼ç‰©</option>
                                <option value="ææ¬¾">ææ¬¾</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>å¤‡æ³¨</label>
                        <input type="text" id="description" placeholder="è¯·è¾“å…¥å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰">
                    </div>

                    <button class="submit-btn" onclick="addTransaction()">æ·»åŠ è®°å½•</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">æœ€è¿‘è®°å½•</div>
                <div class="transactions-list" id="transactionsList">
                    <div class="empty-state">åŠ è½½ä¸­...</div>
                </div>
                <div class="pagination" id="pagination" style="display: none;">
                    <div class="pagination-info" id="paginationInfo"></div>
                    <div class="pagination-controls" id="paginationControls"></div>
                </div>
            </div>

            <div class="card chart-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div class="card-title" style="margin: 0;">é›¶é’±å˜åŒ–è¶‹åŠ¿ï¼ˆè¿‘30å¤©ï¼‰</div>
                    <div style="display: flex; gap: 10px;">
                        <button class="config-btn" onclick="changeChartType('balance')" id="btn-balance">ä½™é¢</button>
                        <button class="config-btn" onclick="changeChartType('income')" id="btn-income">æ”¶å…¥</button>
                        <button class="config-btn" onclick="changeChartType('expense')" id="btn-expense">æ”¯å‡º</button>
                    </div>
                </div>
                <div class="simple-chart" id="trendChart">
                    <svg class="chart-svg" id="chartSvg"></svg>
                    <div class="chart-tooltip" id="chartTooltip"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="scheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ å®šæ—¶å‘æ”¾é…ç½®</h2>
                <button class="close-btn" onclick="closeScheduleModal()">&times;</button>
            </div>

            <div class="modal-body">
                <!-- å·¦ä¾§ï¼šé…ç½®è¡¨å• -->
                <div class="schedule-form-panel">
                    <div class="add-schedule-form">
                        <h3>â• æ·»åŠ æ–°é…ç½®</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å‘æ”¾å‘¨æœŸ</label>
                                <select id="scheduleFrequency" onchange="updateScheduleOptions()">
                                    <option value="daily">æ¯å¤©</option>
                                    <option value="weekly">æ¯å‘¨</option>
                                    <option value="monthly">æ¯æœˆ</option>
                                </select>
                            </div>
                        </div>

                        <!-- æ¯å‘¨é€‰é¡¹ -->
                        <div class="form-row" id="weeklyOptions" style="display: none;">
                            <div class="form-group">
                                <label>é€‰æ‹©æ˜ŸæœŸ</label>
                                <select id="scheduleDayOfWeek">
                                    <option value="1">å‘¨ä¸€</option>
                                    <option value="2">å‘¨äºŒ</option>
                                    <option value="3">å‘¨ä¸‰</option>
                                    <option value="4">å‘¨å››</option>
                                    <option value="5">å‘¨äº”</option>
                                    <option value="6">å‘¨å…­</option>
                                    <option value="0">å‘¨æ—¥</option>
                                </select>
                            </div>
                        </div>

                        <!-- æ¯æœˆé€‰é¡¹ -->
                        <div class="form-row" id="monthlyOptions" style="display: none;">
                            <div class="form-group">
                                <label>é€‰æ‹©æ—¥æœŸ</label>
                                <select id="scheduleDayOfMonth">
                                    <option value="1">1å·</option>
                                    <option value="2">2å·</option>
                                    <option value="3">3å·</option>
                                    <option value="4">4å·</option>
                                    <option value="5">5å·</option>
                                    <option value="6">6å·</option>
                                    <option value="7">7å·</option>
                                    <option value="8">8å·</option>
                                    <option value="9">9å·</option>
                                    <option value="10">10å·</option>
                                    <option value="11">11å·</option>
                                    <option value="12">12å·</option>
                                    <option value="13">13å·</option>
                                    <option value="14">14å·</option>
                                    <option value="15">15å·</option>
                                    <option value="16">16å·</option>
                                    <option value="17">17å·</option>
                                    <option value="18">18å·</option>
                                    <option value="19">19å·</option>
                                    <option value="20">20å·</option>
                                    <option value="21">21å·</option>
                                    <option value="22">22å·</option>
                                    <option value="23">23å·</option>
                                    <option value="24">24å·</option>
                                    <option value="25">25å·</option>
                                    <option value="26">26å·</option>
                                    <option value="27">27å·</option>
                                    <option value="28">28å·</option>
                                    <option value="29">29å·ï¼ˆ2æœˆå¹³å¹´è·³è¿‡ï¼‰</option>
                                    <option value="30">30å·ï¼ˆ2æœˆè·³è¿‡ï¼‰</option>
                                    <option value="31">31å·ï¼ˆ2/4/6/9/11æœˆè·³è¿‡ï¼‰</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>å‘æ”¾é¢åº¦</label>
                                <input type="number" id="scheduleAmount" placeholder="è¯·è¾“å…¥é‡‘é¢" step="0.01" min="0.01">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>åˆ†ç±»</label>
                                <select id="scheduleCategory">
                                    <option value="é›¶èŠ±é’±">é›¶èŠ±é’±</option>
                                    <option value="å¥–åŠ±">å¥–åŠ±</option>
                                    <option value="å¸®å¿™å®¶åŠ¡">å¸®å¿™å®¶åŠ¡</option>
                                    <option value="å…¶ä»–">å…¶ä»–</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>å¤‡æ³¨</label>
                                <input type="text" id="scheduleDescription" placeholder="å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰">
                            </div>
                        </div>
                        <button class="add-schedule-btn" id="addScheduleBtn" onclick="addSchedule()">âœ¨ æ·»åŠ å®šæ—¶å‘æ”¾</button>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šé…ç½®è®°å½•åˆ—è¡¨ -->
                <div class="schedule-list-panel">
                    <h3>ğŸ“‹ é…ç½®è®°å½•</h3>
                    <div class="schedule-list" id="scheduleList">
                        <div class="empty-schedules">
                            <div class="empty-schedules-icon">â°</div>
                            <div>åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentType = 'income';
        let currentChartType = 'balance';
        let trendData = { dates: [], income: [], expense: [], balance: [] };
        let trendChart = null;
        let currentPage = 1;
        let totalPages = 1;
        const perPage = 4;

        function changeChartType(chartType) {
            currentChartType = chartType;

            document.querySelectorAll('.config-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`#btn-${chartType}`).classList.add('active');

            renderChartWithCurrentType();
        }

        function renderChartWithCurrentType() {
            let data;
            switch(currentChartType) {
                case 'income':
                    data = trendData.income;
                    break;
                case 'expense':
                    data = trendData.expense;
                    break;
                default:
                    data = trendData.balance;
            }
            renderChart(trendData.dates, data);
        }

        function setType(type) {

            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.querySelector(`.type-btn.${type}`).classList.add('active');

            // æ ¹æ®æ”¶å…¥/æ”¯å‡ºç±»å‹æ›´æ–°åˆ†ç±»é€‰é¡¹
            updateCategoryOptions(type);
        }

        function updateCategoryOptions(type) {
            const categorySelect = document.getElementById('category');
            const incomeCategories = document.getElementById('incomeCategories');
            const expenseCategories = document.getElementById('expenseCategories');

            // æ¸…ç©ºå½“å‰é€‰æ‹©
            categorySelect.value = '';

            if (type === 'income') {
                // æ˜¾ç¤ºæ”¶å…¥åˆ†ç±»ï¼Œéšè—æ”¯å‡ºåˆ†ç±»
                incomeCategories.style.display = '';
                expenseCategories.style.display = 'none';
                // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªæ”¶å…¥åˆ†ç±»
                categorySelect.value = 'é›¶èŠ±é’±';
            } else {
                // æ˜¾ç¤ºæ”¯å‡ºåˆ†ç±»ï¼Œéšè—æ”¶å…¥åˆ†ç±»
                incomeCategories.style.display = 'none';
                expenseCategories.style.display = '';
                // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªæ”¯å‡ºåˆ†ç±»
                categorySelect.value = 'é›¶é£Ÿ';
            }
        }

        function formatMoney(amount) {
            return 'Â¥' + parseFloat(amount).toFixed(2);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', {
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        async function loadBalance() {
            try {
                const response = await fetch('/api/balance');
                const data = await response.json();

                if (data.success) {
                    document.getElementById('balance').textContent = formatMoney(data.balance);
                    document.getElementById('income').textContent = formatMoney(data.income);
                    document.getElementById('expense').textContent = formatMoney(data.expense);
                }
            } catch (error) {
                console.error('åŠ è½½ä½™é¢å¤±è´¥:', error);
            }
        }

        async function loadTransactions(page = currentPage) {
            try {
                currentPage = page;
                const response = await fetch(`/api/transactions?page=${page}&per_page=${perPage}`);
                const data = await response.json();

                if (data.success) {
                    const listElement = document.getElementById('transactionsList');
                    const paginationElement = document.getElementById('pagination');
                    const paginationInfo = document.getElementById('paginationInfo');
                    const paginationControls = document.getElementById('paginationControls');

                    // è®¡ç®—æ€»é¡µæ•°
                    totalPages = Math.ceil(data.total / perPage);

                    if (data.transactions.length === 0) {
                        listElement.innerHTML = '<div class="empty-state">æš‚æ— è®°å½•</div>';
                        paginationElement.style.display = 'none';
                        return;
                    }

                    // æ¸²æŸ“äº¤æ˜“è®°å½•åˆ—è¡¨ï¼ˆæŒ‰å‘ç”Ÿæ—¶é—´å€’åºï¼Œæœ€æ–°çš„åœ¨å‰ï¼‰
                    listElement.innerHTML = data.transactions.map(tx => `
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div class="transaction-category">${tx.category || 'æœªåˆ†ç±»'}</div>
                                <div class="transaction-description">${tx.description || 'æ— å¤‡æ³¨'}</div>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <div class="transaction-amount ${tx.type}">
                                    ${tx.type === 'income' ? '+' : '-'}${formatMoney(tx.amount)}
                                </div>
                                <div class="transaction-date">${formatDate(tx.created_at)}</div>
                                <button class="delete-btn" onclick="deleteTransaction(${tx.id})">åˆ é™¤</button>
                            </div>
                        </div>
                    `).join('');

                    // æ›´æ–°åˆ†é¡µä¿¡æ¯
                    const start = (page - 1) * perPage + 1;
                    const end = Math.min(page * perPage, data.total);
                    paginationInfo.textContent = `å…± ${data.total} æ¡è®°å½•ï¼Œæ˜¾ç¤ºç¬¬ ${start}-${end} æ¡`;

                    // æ¸²æŸ“åˆ†é¡µæ§ä»¶
                    let paginationHTML = '';
                    
                    // ä¸Šä¸€é¡µæŒ‰é’®
                    paginationHTML += `<button class="pagination-btn" onclick="loadTransactions(${page - 1})" ${page <= 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>`;
                    
                    // é¡µç æŒ‰é’®
                    const maxPagesToShow = 5;
                    let startPage = Math.max(1, page - Math.floor(maxPagesToShow / 2));
                    let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
                    
                    if (endPage - startPage < maxPagesToShow - 1) {
                        startPage = Math.max(1, endPage - maxPagesToShow + 1);
                    }
                    
                    if (startPage > 1) {
                        paginationHTML += `<button class="pagination-btn" onclick="loadTransactions(1)">1</button>`;
                        if (startPage > 2) {
                            paginationHTML += `<span style="padding: 0 5px; color: #999;">...</span>`;
                        }
                    }
                    
                    for (let i = startPage; i <= endPage; i++) {
                        paginationHTML += `<button class="pagination-btn pagination-page ${i === page ? 'active' : ''}" onclick="loadTransactions(${i})">${i}</button>`;
                    }
                    
                    if (endPage < totalPages) {
                        if (endPage < totalPages - 1) {
                            paginationHTML += `<span style="padding: 0 5px; color: #999;">...</span>`;
                        }
                        paginationHTML += `<button class="pagination-btn" onclick="loadTransactions(${totalPages})">${totalPages}</button>`;
                    }
                    
                    // ä¸‹ä¸€é¡µæŒ‰é’®
                    paginationHTML += `<button class="pagination-btn" onclick="loadTransactions(${page + 1})" ${page >= totalPages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>`;
                    
                    paginationControls.innerHTML = paginationHTML;
                    paginationElement.style.display = 'flex';
                }
            } catch (error) {
                console.error('åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥:', error);
                const listElement = document.getElementById('transactionsList');
                listElement.innerHTML = '<div class="empty-state">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
            }
        }

        async function addTransaction() {
            const amount = document.getElementById('amount').value;
            const category = document.getElementById('category').value;
            const description = document.getElementById('description').value;

            if (!amount || parseFloat(amount) <= 0) {
                showMessage('è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢', 'error');
                return;
            }

            try {
                const response = await fetch('/api/transactions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: currentType,
                        amount: amount,
                        category: category,
                        description: description
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('æ·»åŠ æˆåŠŸ', 'success');
                    document.getElementById('amount').value = '';
                    document.getElementById('description').value = '';

                    loadBalance();
                    loadTransactions(1); // æ·»åŠ æ–°è®°å½•åå›åˆ°ç¬¬ä¸€é¡µ
                    loadTrends();
                } else {
                    showMessage(data.message, 'error');
                }
            } catch (error) {
                showMessage('æ·»åŠ å¤±è´¥', 'error');
            }
        }

        async function deleteTransaction(txId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                return;
            }

            try {
                const response = await fetch(`/api/transactions/${txId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('åˆ é™¤æˆåŠŸ', 'success');
                    loadBalance();
                    
                    // æ£€æŸ¥å½“å‰é¡µæ˜¯å¦è¿˜æœ‰æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™å›åˆ°ä¸Šä¸€é¡µ
                    const checkResponse = await fetch(`/api/transactions?page=${currentPage}&per_page=${perPage}`);
                    const checkData = await checkResponse.json();
                    if (checkData.success) {
                        if (checkData.transactions.length === 0 && currentPage > 1) {
                            loadTransactions(currentPage - 1);
                        } else {
                            loadTransactions(currentPage);
                        }
                    } else {
                        loadTransactions(currentPage);
                    }
                    loadTrends();
                }
            } catch (error) {
                showMessage('åˆ é™¤å¤±è´¥', 'error');
            }
        }

        async function loadTrends() {
            try {
                const response = await fetch('/api/trends?days=30');
                const data = await response.json();

                console.log('Trends data:', data);

                if (data.success) {
                    trendData = {
                        dates: data.dates,
                        income: data.income,
                        expense: data.expense,
                        balance: data.balance
                    };
                    renderChartWithCurrentType();
                } else {
                    console.error('APIè¿”å›å¤±è´¥:', data);
                }
            } catch (error) {
                console.error('åŠ è½½è¶‹åŠ¿æ•°æ®å¤±è´¥:', error);
            }
        }

        function renderChart(dates, balances) {
            console.log('=== renderChart START ===');
            console.log('dates:', dates);
            console.log('balances:', balances);
            console.log('chartType:', currentChartType);

            const svg = document.getElementById('chartSvg');
            const tooltip = document.getElementById('chartTooltip');

            console.log('svg element:', svg);
            console.log('tooltip element:', tooltip);

            if (!svg) {
                console.error('SVG element not found!');
                return;
            }

            const width = svg.clientWidth || svg.parentElement.clientWidth || 800;
            const height = svg.clientHeight || svg.parentElement.clientHeight || 300;
            const padding = { top: 20, right: 30, bottom: 40, left: 60 };

            console.log('dimensions:', { width, height, clientWidth: svg.clientWidth, clientHeight: svg.clientHeight });

            if (balances.length === 0) {
                svg.innerHTML = '<text x="50%" y="50%" text-anchor="middle" fill="#999">æš‚æ— æ•°æ®</text>';
                return;
            }

            const hasNegativeValues = balances.some(b => b < 0);
            const maxValue = Math.max(...balances, 0);
            const minValue = hasNegativeValues ? Math.min(...balances) : 0;
            const range = maxValue - minValue || 1;

            console.log('value calculations:', { hasNegativeValues, maxValue, minValue, range });

            const chartHeight = height - padding.top - padding.bottom;
            const chartWidth = width - padding.left - padding.right;
            const barWidth = Math.min(40, chartWidth / dates.length * 0.6);
            const barSpacing = chartWidth / dates.length;

            console.log('chart dimensions:', { chartHeight, chartWidth, barWidth, barSpacing });

            const xScale = (index) => padding.left + (index * barSpacing) + (barSpacing - barWidth) / 2;

            const yScale = (value) => {
                if (range === 0) return height - padding.bottom - chartHeight / 2;
                return height - padding.bottom - ((value - minValue) / range) * chartHeight;
            };

            const zeroY = yScale(0);
            console.log('zeroY:', zeroY);

            let svgContent = '';

            const gridLines = 5;
            for (let i = 0; i <= gridLines; i++) {
                const value = minValue + (range * i / gridLines);
                const y = yScale(value);
                svgContent += `<line class="chart-grid" x1="${padding.left}" y1="${y}" x2="${width - padding.right}" y2="${y}"/>`;
                svgContent += `<text class="chart-label" x="${padding.left - 10}" y="${y + 4}" text-anchor="end">Â¥${value.toFixed(0)}</text>`;
            }

            console.log('grid lines created');

            const barClass = currentChartType;
            let barsCreated = 0;

            balances.forEach((b, i) => {
                const x = xScale(i);
                const valueY = yScale(b);

                let barY, barHeight;
                if (b >= 0) {
                    barHeight = Math.max(1, zeroY - valueY);
                    barY = valueY;
                } else {
                    barHeight = Math.max(1, valueY - zeroY);
                    barY = zeroY;
                }

                if (i < 3) {
                    console.log(`Bar ${i}:`, { b, x, valueY, barY, barHeight });
                }

                svgContent += `<rect class="chart-bar ${barClass}" x="${x}" y="${barY}" width="${barWidth}" height="${barHeight}" rx="3"
                    data-date="${dates[i]}" data-value="${b.toFixed(2)}"
                    onmouseover="showChartTooltip('${dates[i]}', '${b.toFixed(2)}', '${currentChartType}', ${x}, ${barY}, ${barWidth})"
                    onmouseout="hideChartTooltip()"
                    style="cursor: pointer"/>`;
                barsCreated++;

                if (i % Math.max(1, Math.ceil(dates.length / 6)) === 0 || i === dates.length - 1) {
                    const labelX = x + barWidth / 2;
                    const dateLabel = dates[i].substring(5);
                    svgContent += `<text class="chart-label" x="${labelX}" y="${height - 10}" text-anchor="middle">${dateLabel}</text>`;
                }
            });

            console.log('bars created:', barsCreated);
            console.log('svgContent length:', svgContent.length);

            svg.innerHTML = svgContent;
            console.log('SVG innerHTML set, children count:', svg.children.length);
            console.log('=== renderChart END ===');
        }

        function showChartTooltip(date, value, type, x, y, width) {
            const tooltip = document.getElementById('chartTooltip');
            const label = type === 'balance' ? 'ä½™é¢' : (type === 'income' ? 'æ”¶å…¥' : 'æ”¯å‡º');
            tooltip.style.display = 'block';
            tooltip.style.left = (x + width + 10) + 'px';
            tooltip.style.top = (y - 30) + 'px';
            tooltip.textContent = `${date}: ${label} Â¥${value}`;
        }

        function hideChartTooltip() {
            const tooltip = document.getElementById('chartTooltip');
            tooltip.style.display = 'none';
        }

        function showMessage(message, type) {
            const existingMessage = document.querySelector('.message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;

            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);

            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        function updateScheduleOptions() {
            const frequency = document.getElementById('scheduleFrequency').value;
            const weeklyOptions = document.getElementById('weeklyOptions');
            const monthlyOptions = document.getElementById('monthlyOptions');

            weeklyOptions.style.display = 'none';
            monthlyOptions.style.display = 'none';

            if (frequency === 'weekly') {
                weeklyOptions.style.display = 'flex';
            } else if (frequency === 'monthly') {
                monthlyOptions.style.display = 'flex';
            }
        }

        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                window.location.href = '/logout';
            }
        }

        function openScheduleModal() {
            const modal = document.getElementById('scheduleModal');
            if (modal) {
                modal.classList.add('active');
                loadSchedules();
            }
        }

        function closeScheduleModal() {
            document.getElementById('scheduleModal').classList.remove('active');
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('scheduleModal');
            if (event.target === modal) {
                closeScheduleModal();
            }
        });

        // ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('scheduleModal');
                if (modal && modal.classList.contains('active')) {
                    closeScheduleModal();
                }
            }
        });

        async function loadSchedules() {
            try {
                const response = await fetch('/api/schedules');
                const data = await response.json();

                if (data.success) {
                    renderSchedules(data.schedules);
                } else {
                    const listElement = document.getElementById('scheduleList');
                    listElement.innerHTML = `
                        <div class="empty-schedules">
                            <div class="empty-schedules-icon">âš ï¸</div>
                            <div>åŠ è½½é…ç½®å¤±è´¥</div>
                            <div style="margin-top: 10px; font-size: 12px; color: #999;">${data.message || 'è¯·ç¨åé‡è¯•'}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('åŠ è½½å®šæ—¶å‘æ”¾é…ç½®å¤±è´¥:', error);
                const listElement = document.getElementById('scheduleList');
                listElement.innerHTML = `
                    <div class="empty-schedules">
                        <div class="empty-schedules-icon">âš ï¸</div>
                        <div>åŠ è½½é…ç½®å¤±è´¥</div>
                        <div style="margin-top: 10px; font-size: 12px; color: #999;">ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•</div>
                    </div>
                `;
            }
        }

        function renderSchedules(schedules) {
            const listElement = document.getElementById('scheduleList');

            if (schedules.length === 0) {
                listElement.innerHTML = `
                    <div class="empty-schedules">
                        <div class="empty-schedules-icon">ğŸ“</div>
                        <div>æš‚æ— å®šæ—¶å‘æ”¾é…ç½®</div>
                        <div style="margin-top: 10px; font-size: 12px; color: #999;">è¯·åœ¨å·¦ä¾§æ·»åŠ æ–°é…ç½®</div>
                    </div>
                `;
                return;
            }

            const frequencyText = {
                'daily': 'æ¯å¤©',
                'weekly': 'æ¯å‘¨',
                'monthly': 'æ¯æœˆ'
            };

            const weekDayText = {
                '0': 'å‘¨æ—¥',
                '1': 'å‘¨ä¸€',
                '2': 'å‘¨äºŒ',
                '3': 'å‘¨ä¸‰',
                '4': 'å‘¨å››',
                '5': 'å‘¨äº”',
                '6': 'å‘¨å…­'
            };

            const frequencyIcons = {
                'daily': 'ğŸ“…',
                'weekly': 'ğŸ“†',
                'monthly': 'ğŸ—“ï¸'
            };

            listElement.innerHTML = schedules.map(schedule => {
                let detailText = frequencyText[schedule.frequency];
                let icon = frequencyIcons[schedule.frequency];
                
                if (schedule.frequency === 'weekly' && schedule.day_of_week !== null) {
                    detailText += ' ' + weekDayText[schedule.day_of_week.toString()];
                } else if (schedule.frequency === 'monthly' && schedule.day_of_month !== null) {
                    detailText += ' ' + schedule.day_of_month + 'å·';
                }

                return `
                <div class="schedule-item">
                    <div class="schedule-info">
                        <h4>${icon} ${detailText} Â· ${schedule.category}</h4>
                        <p>
                            <span class="schedule-amount">${formatMoney(schedule.amount)}</span>
                            ${schedule.description ? '<span style="color: #999;">| ' + schedule.description + '</span>' : ''}
                        </p>
                    </div>
                    <div class="schedule-actions">
                        <button class="delete-btn" onclick="deleteSchedule(${schedule.id})">åˆ é™¤</button>
                    </div>
                </div>
                `;
            }).join('');
        }

        async function addSchedule() {
            const addBtn = document.getElementById('addScheduleBtn');
            const frequency = document.getElementById('scheduleFrequency').value;
            const amount = document.getElementById('scheduleAmount').value;
            const category = document.getElementById('scheduleCategory').value;
            const description = document.getElementById('scheduleDescription').value;

            // è¡¨å•éªŒè¯
            if (!amount || parseFloat(amount) <= 0) {
                showMessage('è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢', 'error');
                document.getElementById('scheduleAmount').focus();
                return;
            }

            if (parseFloat(amount) > 999999) {
                showMessage('é‡‘é¢è¿‡å¤§ï¼Œè¯·è¾“å…¥å°äº100ä¸‡çš„é‡‘é¢', 'error');
                document.getElementById('scheduleAmount').focus();
                return;
            }

            if (!category || category.trim() === '') {
                showMessage('è¯·é€‰æ‹©åˆ†ç±»', 'error');
                document.getElementById('scheduleCategory').focus();
                return;
            }

            // é˜²æ­¢é‡å¤æäº¤
            if (addBtn.disabled) {
                return;
            }

            // è·å–å‘¨æœŸç‰¹å®šçš„å‚æ•°
            let dayOfWeek = null;
            let dayOfMonth = null;

            if (frequency === 'weekly') {
                dayOfWeek = document.getElementById('scheduleDayOfWeek').value;
            } else if (frequency === 'monthly') {
                dayOfMonth = document.getElementById('scheduleDayOfMonth').value;
            }

            // ç¦ç”¨æŒ‰é’®ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€
            addBtn.disabled = true;
            const originalText = addBtn.textContent;
            addBtn.textContent = 'â³ æ·»åŠ ä¸­...';

            try {
                const response = await fetch('/api/schedules', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        frequency: frequency,
                        amount: amount,
                        category: category,
                        description: description,
                        day_of_week: dayOfWeek,
                        day_of_month: dayOfMonth
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('æ·»åŠ æˆåŠŸ', 'success');
                    // é‡ç½®è¡¨å•
                    document.getElementById('scheduleFrequency').value = 'daily';
                    document.getElementById('scheduleAmount').value = '';
                    document.getElementById('scheduleCategory').value = 'é›¶èŠ±é’±';
                    document.getElementById('scheduleDescription').value = '';
                    document.getElementById('weeklyOptions').style.display = 'none';
                    document.getElementById('monthlyOptions').style.display = 'none';
                    // æ»šåŠ¨åˆ°åˆ—è¡¨é¡¶éƒ¨ï¼Œè®©ç”¨æˆ·çœ‹åˆ°æ–°æ·»åŠ çš„é…ç½®
                    const listPanel = document.querySelector('.schedule-list-panel');
                    if (listPanel) {
                        listPanel.scrollTop = 0;
                    }
                    loadSchedules();
                } else {
                    showMessage(data.message || 'æ·»åŠ å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('æ·»åŠ å®šæ—¶å‘æ”¾é…ç½®å¤±è´¥:', error);
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œæ·»åŠ å¤±è´¥', 'error');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                addBtn.disabled = false;
                addBtn.textContent = originalText;
            }
        }

        async function deleteSchedule(scheduleId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå®šæ—¶å‘æ”¾é…ç½®å—ï¼Ÿ')) {
                return;
            }

            try {
                const response = await fetch(`/api/schedules/${scheduleId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('åˆ é™¤æˆåŠŸ', 'success');
                    loadSchedules();
                } else {
                    showMessage(data.message, 'error');
                }
            } catch (error) {
                showMessage('åˆ é™¤å¤±è´¥', 'error');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            updateCategoryOptions('income');

            document.querySelector('#btn-balance').classList.add('active');

            loadBalance();
            loadTransactions();
            loadTrends();

            setInterval(() => {
                loadBalance();
                loadTransactions();
            }, 30000);
        });
    </script>
</body>
</html>
